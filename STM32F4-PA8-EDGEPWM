// PWM SIGNAL OUTPUTTED VIA TIM1, CHANNEL 1, PWM SIGNAL DIRECTED TOWARDS PA8. CONFIGURE P8 FOR ALTERNATE FUNCTION 1.

#include "stm32f401xe.h"

void EdgePWMInit (void) {

RCC->APB2ENR |= (RCC_APB2ENR_TIM1EN); // TIM1 Clock set, Checked and valid
TIM1->PSC = 5; // Prescaler, Checked and valid
TIM1->CR1 &= ~(TIM_CR1_DIR); // Checked and valid 
TIM1->CCMR1 &= ~(TIM_CCMR1_CC1S_0);
TIM1->CCMR1 &= ~(TIM_CCMR1_CC1S_1); // Output 1 CCS bits set Checked and valid 
TIM1->CCER &= ~(TIM_CCER_CC1P); // Polarity bit on Channel 1  Checked and valud
TIM1->CCMR1 &= ~(TIM_CCMR1_OC1M_0);
TIM1->CCMR1 |= (TIM_CCMR1_OC1M_1);
TIM1->CCMR1 |= (TIM_CCMR1_OC1M_2); // PWM MODE 1, Channel 1  Checked and valid
TIM1->ARR = 30000; // Resolution Checked and valid 
TIM1->CR1 |= (TIM_CR1_ARPE); // ARPE bit set  Checked and valid 
TIM1->CCMR1 |= (TIM_CCMR1_OC1PE); // Compare register Preload bit set Checked and valid 
TIM1->CR1 &= ~(TIM_CR1_CMS_0);
TIM1->CR1 &= ~(TIM_CR1_CMS_1); // Edge aligned Mode Checked and valid 
TIM1->CCER |= (TIM_CCER_CC1E); // Compare enable Checked and valid 
TIM1->BDTR |= (TIM_BDTR_MOE); // ESSENTIAL, Allows for the signal output on the pin
TIM1->CCR1 = 10000;
TIM1->EGR |= (TIM_EGR_UG);
TIM1->CR1 |= (TIM_CR1_CEN); // Counter enable Checked and valid 

}

void EdgePulse (double pulse) { // Enter a voltage of high precision
	float n = 100;
	TIM1->CCR1 = (int) (pulse * (30000 / n)); // Pulse entered

}

